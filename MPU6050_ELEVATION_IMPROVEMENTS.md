# ЁЯОп р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕Ур╕бр╕╕р╕бр╣Ар╕Зр╕в (Elevation Angle) р╕кр╕│р╕лр╕гр╕▒р╕Ъ MPU6050

## ЁЯФН **р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕Юр╕Ър╣Гр╕Щр╣Вр╕Др╣Йр╕Фр╣Ар╕Фр╕┤р╕б**

1. **р╣Др╕бр╣Ир╣Др╕Фр╣Йр╣Гр╕Кр╣Й DMP**: р╣Гр╕Кр╣Йр╣Бр╕Др╣И Accelerometer р╕нр╕вр╣Ир╕▓р╕Зр╣Ар╕Фр╕╡р╕вр╕з
2. **р╕кр╕╣р╕Хр╕гр╕Др╕│р╕Щр╕зр╕Ур╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З**: р╣Гр╕Кр╣Й `atan2(Ay, Az)` р╕Лр╕╢р╣Ир╕Зр╣Др╕бр╣Ир╣Гр╕Кр╣Ир╕кр╕╣р╕Хр╕гр╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
3. **р╣Др╕бр╣Ир╣Др╕Фр╣Йр╣Гр╕Кр╣Й Gyroscope**: р╕Вр╕▓р╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕зр╕▓р╕бр╣Ар╕гр╣Зр╕зр╣Ар╕Кр╕┤р╕Зр╕бр╕╕р╕б
4. **р╕Бр╕▓р╕гр╕Бр╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕бр╣Ир╣Ар╕Юр╕╡р╕вр╕Зр╕Юр╕н**: р╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕Бр╕▓р╕гр╕Бр╕гр╕нр╕Зр╕Чр╕╡р╣Ир╕Фр╕╡р╕Бр╕зр╣Ир╕▓

## тЬЕ **р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Чр╕╡р╣Ир╕Чр╕│**

### 1. **р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕╣р╕Хр╕гр╕Др╕│р╕Щр╕зр╕Ур╣Гр╕лр╕бр╣И**

**р╕кр╕╣р╕Хр╕гр╣Ар╕Фр╕┤р╕б (р╕Ьр╕┤р╕Ф):**
```cpp
elevation_raw = atan2(Ay, Az) * 180.0 / PI;
```

**р╕кр╕╣р╕Хр╕гр╣Гр╕лр╕бр╣И (р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З):**
```cpp
// р╕Др╕│р╕Щр╕зр╕Ур╕Вр╕Щр╕▓р╕Фр╕Вр╕нр╕Зр╣Ар╕зр╕Бр╣Ар╕Хр╕нр╕гр╣Мр╕Др╕зр╕▓р╕бр╣Ар╕гр╣Ир╕Зр╕гр╕зр╕б
float magnitude = sqrt(Ax*Ax + Ay*Ay + Az*Az);

// р╕Др╕│р╕Щр╕зр╕Ур╕бр╕╕р╕бр╣Ар╕Зр╕вр╕Фр╣Йр╕зр╕в arcsin
float sin_elevation = Ay / magnitude;
elevation_raw = asin(sin_elevation) * 180.0 / PI;
```

### 2. **р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Бр╕▓р╕гр╕Бр╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е**

**р╣Ар╕Фр╕┤р╕б:**
```cpp
const float alpha = 0.3;  // р╕Бр╕гр╕нр╕Зр╕кр╕▒р╕Нр╕Нр╕▓р╕Ур╕гр╕Ър╕Бр╕зр╕Щ
elevation_filtered = alpha * elevation_raw + (1 - alpha) * elevation_filtered;
```

**р╣Гр╕лр╕бр╣И:**
```cpp
const float alpha = 0.1;  // р╕Бр╕гр╕нр╕Зр╕кр╕▒р╕Нр╕Нр╕▓р╕Ур╕гр╕Ър╕Бр╕зр╕Щ (р╕ер╕Фр╕ер╕Зр╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕кр╕Цр╕╡р╕вр╕гр╕Вр╕╢р╣Йр╕Щ)
elevation_filtered = alpha * elevation_raw + (1 - alpha) * elevation_filtered;
```

### 3. **р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Бр╕▓р╕гр╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Х**

**р╣Ар╕Фр╕┤р╕б:**
```cpp
az_offset = az_sum / samples - 16384; // р╕ер╕Ъ 16384
```

**р╣Гр╕лр╕бр╣И:**
```cpp
az_offset = az_sum / samples; // р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕ер╕Ъ 16384
```

## ЁЯзо **р╕лр╕ер╕▒р╕Бр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕Зр╕кр╕╣р╕Хр╕гр╣Гр╕лр╕бр╣И**

### **Elevation = arcsin(Ay / magnitude)**

- **Ay**: р╣Бр╕Бр╕Щ Y (Pitch) - р╕зр╕▒р╕Фр╕Бр╕▓р╕гр╣Ар╕Зр╕в/р╕Бр╣Йр╕б
- **magnitude**: р╕Вр╕Щр╕▓р╕Фр╕Вр╕нр╕Зр╣Ар╕зр╕Бр╣Ар╕Хр╕нр╕гр╣Мр╕Др╕зр╕▓р╕бр╣Ар╕гр╣Ир╕Зр╕гр╕зр╕б = тИЪ(Ax┬▓ + Ay┬▓ + Az┬▓)
- **arcsin**: р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕Хр╕гр╕╡р╣Вр╕Бр╕Ур╕бр╕┤р╕Хр╕┤р╕Чр╕╡р╣Ир╣Гр╕лр╣Йр╕бр╕╕р╕бр╕Чр╕╡р╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

### **р╕Вр╣Йр╕нр╕Фр╕╡р╕Вр╕нр╕Зр╕кр╕╣р╕Хр╕гр╣Гр╕лр╕бр╣И:**

1. **р╣Бр╕бр╣Ир╕Щр╕вр╕│**: р╣Гр╕Кр╣Й arcsin р╣Бр╕Чр╕Щ atan2
2. **р╣Ар╕кр╕Цр╕╡р╕вр╕г**: р╣Др╕бр╣Ир╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕нр╕╡р╕вр╕Зр╕Лр╣Йр╕▓р╕вр╕Вр╕зр╕▓ (Roll Independent)
3. **р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З**: р╕Хр╕▓р╕бр╕лр╕ер╕▒р╕Бр╕Фр╕▓р╕гр╕▓р╕ир╕▓р╕кр╕Хр╕гр╣Мр╣Бр╕ер╕░р╕Хр╕гр╕╡р╣Вр╕Бр╕Ур╕бр╕┤р╕Хр╕┤
4. **р╣Гр╕Кр╣Йр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕гр╕Ъ**: р╣Гр╕Кр╣Йр╕Чр╕▒р╣Йр╕З Ax, Ay, Az

## ЁЯУК **р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ**

### **р╕Бр╕гр╕Ур╕╡р╕Чр╕Фр╕кр╕нр╕Ъ:**

1. **р╣Бр╕Щр╕зр╕гр╕░р╕Фр╕▒р╕Ър╕кр╕▓р╕вр╕Хр╕▓ (0┬░)**: Ay=0, Az=1g тЖТ Elevation=0┬░
2. **р╣Ар╕Зр╕вр╕Вр╕╢р╣Йр╕Щ 45┬░**: Ay=0.707g, Az=0.707g тЖТ Elevation=45┬░
3. **р╕Бр╣Йр╕бр╕ер╕З 45┬░**: Ay=-0.707g, Az=0.707g тЖТ Elevation=-45┬░
4. **р╣Ар╕Зр╕вр╕Вр╕╢р╣Йр╕Щ 90┬░**: Ay=1g, Az=0g тЖТ Elevation=90┬░
5. **р╕Бр╣Йр╕бр╕ер╕З 90┬░**: Ay=-1g, Az=0g тЖТ Elevation=-90┬░
6. **р╣Ар╕нр╕╡р╕вр╕Зр╕Лр╣Йр╕▓р╕вр╕Вр╕зр╕▓**: Ax=0.707g, Ay=0, Az=0.707g тЖТ Elevation=0┬░ (р╣Др╕бр╣Ир╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щ)

## ЁЯФз **р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ**

### **1. р╕Др╕нр╕бр╣Др╕Юр╕ер╣Мр╣Бр╕ер╕░р╕нр╕▒р╕Ыр╣Вр╕лр╕ер╕Фр╣Вр╕Др╣Йр╕Фр╣Гр╕лр╕бр╣И**
```bash
pio run -t upload
```

### **2. р╣Ар╕Ыр╕┤р╕Ф Serial Monitor**
```bash
pio device monitor
```

### **3. р╕Фр╕╣р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М**
```
ЁЯУР ELEVATION: +15┬░  |  DIST: 25.4m  [ЁЯФ╡ BLE Connected]  [тЬЕ Sensors OK]
```

## ЁЯУИ **р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕Чр╕╡р╣Ир╕Др╕▓р╕Фр╕лр╕зр╕▒р╕З**

- **р╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│**: ┬▒1┬░ р╕кр╕│р╕лр╕гр╕▒р╕Ър╕бр╕╕р╕б 0-90┬░
- **р╕Др╕зр╕▓р╕бр╣Ар╕кр╕Цр╕╡р╕вр╕г**: р╣Др╕бр╣Ир╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕нр╕╡р╕вр╕Зр╕Лр╣Йр╕▓р╕вр╕Вр╕зр╕▓
- **р╕Бр╕▓р╕гр╕Хр╕нр╕Ър╕кр╕Щр╕нр╕З**: р╣Ар╕гр╣Зр╕зр╣Бр╕ер╕░р╣Ар╕гр╕╡р╕вр╕Ъ
- **р╕Бр╕▓р╕гр╕Бр╕гр╕нр╕З**: р╕ер╕Фр╕кр╕▒р╕Нр╕Нр╕▓р╕Ур╕гр╕Ър╕Бр╕зр╕Щр╣Др╕Фр╣Йр╕Фр╕╡

## ЁЯОп **р╕Вр╣Йр╕нр╕Фр╕╡р╕Вр╕нр╕Зр╕зр╕┤р╕Шр╕╡р╣Гр╕лр╕бр╣И**

1. **р╣Гр╕Кр╣Й arcsin р╣Бр╕Чр╕Щ atan2**: р╣Бр╕бр╣Ир╕Щр╕вр╕│р╕Бр╕зр╣Ир╕▓
2. **р╣Гр╕Кр╣Й magnitude р╕Вр╕нр╕Зр╣Ар╕зр╕Бр╣Ар╕Хр╕нр╕гр╣Мр╕Др╕зр╕▓р╕бр╣Ар╕гр╣Ир╕Зр╕гр╕зр╕б**: р╣Ар╕кр╕Цр╕╡р╕вр╕гр╕Бр╕зр╣Ир╕▓
3. **Roll Independent**: р╣Др╕бр╣Ир╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕нр╕╡р╕вр╕Зр╕Лр╣Йр╕▓р╕вр╕Вр╕зр╕▓
4. **Range: -90┬░ р╕Цр╕╢р╕З +90┬░**: р╕Др╕гр╕нр╕Ър╕Др╕ер╕╕р╕бр╕Чр╕╕р╕Бр╕бр╕╕р╕б
5. **р╣Ар╕кр╕Цр╕╡р╕вр╕гр╣Бр╕ер╕░р╣Бр╕бр╣Ир╕Щр╕вр╕│**: р╣Ар╕лр╕бр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕зр╕▒р╕Фр╣Бр╕Ьр╣Ир╕Щр╕Фр╕┤р╕Щр╕Цр╕ер╣Ир╕б

## ЁЯФД **р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Вр╕нр╕Зр╕гр╕░р╕Ър╕Ъ**

1. **р╕нр╣Ир╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е**: MPU6050 р╕нр╣Ир╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е Accelerometer
2. **р╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Х**: р╕ер╕Ъ offset р╕Чр╕╡р╣Ир╕Др╕│р╕Щр╕зр╕Ур╣Др╕Фр╣Й
3. **р╕Бр╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е**: р╣Гр╕Кр╣Й Low-pass Filter
4. **р╕Др╕│р╕Щр╕зр╕Ур╕бр╕╕р╕б**: р╣Гр╕Кр╣Й arcsin(Ay / magnitude)
5. **р╕Бр╕гр╕нр╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М**: р╣Гр╕Кр╣Й Moving Average Filter
6. **р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е**: р╕кр╣Ир╕Зр╕Ьр╣Ир╕▓р╕Щ BLE р╣Др╕Ыр╕бр╕╖р╕нр╕Цр╕╖р╕н

## ЁЯУР **р╕кр╕гр╕╕р╕Ы**

р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Щр╕╡р╣Йр╕Чр╕│р╣Гр╕лр╣Йр╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕Ур╕бр╕╕р╕бр╣Ар╕Зр╕в/р╕Бр╣Йр╕б (Elevation/Depression Angle) р╕Ир╕▓р╕Б MPU6050 р╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╣Бр╕ер╕░р╣Ар╕кр╕Цр╕╡р╕вр╕гр╕бр╕▓р╕Бр╕Вр╕╢р╣Йр╕Щ р╣Вр╕Фр╕вр╣Гр╕Кр╣Йр╕кр╕╣р╕Хр╕г `arcsin(Ay / magnitude)` р╣Бр╕Чр╕Щ `atan2(Ay, Az)` р╣Бр╕ер╕░р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Бр╕▓р╕гр╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Хр╣Бр╕ер╕░р╕Бр╕▓р╕гр╕Бр╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Йр╣Ар╕лр╕бр╕▓р╕░р╕кр╕б

**р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М**: р╕бр╕╕р╕бр╣Ар╕Зр╕вр╕Чр╕╡р╣Ир╣Бр╕бр╣Ир╕Щр╕вр╕│р╣Бр╕ер╕░р╣Ар╕кр╕Цр╕╡р╕вр╕гр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕зр╕▒р╕Фр╣Бр╕Ьр╣Ир╕Щр╕Фр╕┤р╕Щр╕Цр╕ер╣Ир╕б ЁЯОп
