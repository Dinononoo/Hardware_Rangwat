# ЁЯОп MPU6050 Improvements Documentation

## ЁЯУЛ **р╕кр╕гр╕╕р╕Ыр╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З MPU6050**

### тЬЕ **р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕лр╕ер╕▒р╕Б:**

1. **р╕Бр╕▓р╕гр╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Хр╣Ар╕гр╣Зр╕зр╕Вр╕╢р╣Йр╕Щ** (3 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡ р╣Бр╕Чр╕Щ 10 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡)
2. **р╕Бр╕▓р╕гр╕Бр╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б** (р╕ер╕Фр╕Бр╕▓р╕гр╣Гр╕Кр╣Й filter р╕лр╕ер╕▓р╕вр╕Кр╕▒р╣Йр╕Щ)
3. **р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕╕р╕Ур╕ар╕▓р╕Юр╕Вр╣Йр╕нр╕бр╕╣р╕е** (р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф)
4. **р╕гр╕░р╕Ър╕Ър╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤** (р╣Ар╕бр╕╖р╣Ир╕нр╣Ар╕Лр╣Зр╕Щр╣Ар╕Лр╕нр╕гр╣Мр╕бр╕╡р╕Ыр╕▒р╕Нр╕лр╕▓)
5. **р╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Чр╕╡р╣Ир╕Кр╕▒р╕Фр╣Ар╕Ир╕Щ** (р╕ер╕Ф debug message)

---

## ЁЯФз **р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Ф:**

### 1. **р╕Бр╕▓р╕гр╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Хр╣Ар╕гр╣Зр╕зр╕Вр╕╢р╣Йр╕Щ**
```cpp
// р╣Ар╕Фр╕┤р╕б: 10 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡, 1000 samples
// р╣Гр╕лр╕бр╣И: 3 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡, 500 samples
const int samples = 500; // р╕ер╕Фр╕Ир╕▓р╕Б 1000
delay(1); // р╕ер╕Фр╕Ир╕▓р╕Б 2ms
```

**р╕Ыр╕гр╕░р╣Вр╕вр╕Кр╕Щр╣М:**
- р╣Ар╕гр╕┤р╣Ир╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╣Ар╕гр╣Зр╕зр╕Вр╕╢р╣Йр╕Щ
- р╕Ыр╕гр╕░р╕лр╕вр╕▒р╕Фр╣Ар╕зр╕ер╕▓р╣Гр╕Щр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓
- р╕вр╕▒р╕Зр╕Др╕Зр╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│

### 2. **р╕Бр╕▓р╕гр╕Бр╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╣Ар╕лр╕бр╕▓р╕░р╕кр╕б**
```cpp
// р╣Ар╕Фр╕┤р╕б: р╣Гр╕Кр╣Й filter р╕лр╕ер╕▓р╕вр╕Кр╕▒р╣Йр╕Щ
pitch_filtered = alpha1 * elevation_raw + (1 - alpha1) * pitch_filtered;
pitch_smooth = getMovingAverage(pitch_history, pitch_filtered);

// р╣Гр╕лр╕бр╣И: р╣Гр╕Кр╣Й filter р╣Ар╕Фр╕╡р╕вр╕з + threshold
const float filter_alpha = 0.1; // р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕зр╕▓р╕бр╣Др╕з
float threshold = 0.5; // р╣Ар╕Юр╕┤р╣Ир╕бр╕Ир╕▓р╕Б 0.1 р╕нр╕Зр╕ир╕▓

if (abs(pitch_filtered - pitch_smooth) > threshold) {
    pitch_smooth = getMovingAverage(pitch_history, pitch_filtered);
}
```

**р╕Ыр╕гр╕░р╣Вр╕вр╕Кр╕Щр╣М:**
- р╕Хр╕нр╕Ър╕кр╕Щр╕нр╕Зр╣Ар╕гр╣Зр╕зр╕Вр╕╢р╣Йр╕Щ
- р╕ер╕Фр╕Бр╕▓р╕гр╣Гр╕Кр╣Й CPU
- р╕вр╕▒р╕Зр╕Др╕Зр╕Др╕зр╕▓р╕бр╣Ар╕кр╕Цр╕╡р╕вр╕г

### 3. **р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕╕р╕Ур╕ар╕▓р╕Юр╕Вр╣Йр╕нр╕бр╕╣р╕е**
```cpp
bool isMPU6050DataValid() {
    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╣Ир╕▓р╕Чр╕╡р╣Ир╕кр╕бр╣Ар╕лр╕Хр╕╕р╕кр╕бр╕Ьр╕е
    if (abs(ax) > 30000 || abs(ay) > 30000 || abs(az) > 30000) return false;
    if (abs(gx) > 30000 || abs(gy) > 30000 || abs(gz) > 30000) return false;
    return true;
}
```

**р╕Ыр╕гр╕░р╣Вр╕вр╕Кр╕Щр╣М:**
- р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф
- р╕ер╕Фр╕Бр╕▓р╕гр╕Др╕│р╕Щр╕зр╕Ур╕Чр╕╡р╣Ир╕Ьр╕┤р╕Ф
- р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕зр╕▓р╕бр╣Ар╕кр╕Цр╕╡р╕вр╕г

### 4. **р╕гр╕░р╕Ър╕Ър╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤**
```cpp
void resetMPU6050() {
    Serial.println("ЁЯФД Resetting MPU6050...");
    mpu.initialize();
    // р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕Хр╕▒р╕зр╣Бр╕Ыр╕гр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
    // р╕ер╣Йр╕▓р╕З history arrays
}
```

**р╕Ыр╕гр╕░р╣Вр╕вр╕Кр╕Щр╣М:**
- р╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓р╣Ар╕Лр╣Зр╕Щр╣Ар╕Лр╕нр╕гр╣Мр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- р╕ер╕Фр╕Бр╕▓р╕гр╕лр╕вр╕╕р╕Фр╕Чр╕│р╕Зр╕▓р╕Щ
- р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╣Ар╕Кр╕╖р╣Ир╕нр╕Цр╕╖р╕н

### 5. **р╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ MPU6050 р╕Чр╕╡р╣Ир╕Фр╕╡р╕Вр╕╢р╣Йр╕Щ**
```cpp
// р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б
mpu.setSleepEnabled(false);                      // р╕Ыр╕┤р╕Ф sleep mode
mpu.setClockSource(MPU6050_CLOCK_PLL_XGYRO);     // р╣Гр╕Кр╣Й X-axis gyro р╣Ар╕Ыр╣Зр╕Щ clock source
mpu.setIntDataReadyEnabled(true);                // р╣Ар╕Ыр╕┤р╕Ф data ready interrupt
```

**р╕Ыр╕гр╕░р╣Вр╕вр╕Кр╕Щр╣М:**
- р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕зр╕▓р╕бр╣Ар╕кр╕Цр╕╡р╕вр╕г
- р╕ер╕Фр╕Бр╕▓р╕гр╕гр╕Ър╕Бр╕зр╕Щ
- р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│

---

## ЁЯУК **р╕Ьр╕ер╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З:**

### **р╕Бр╣Ир╕нр╕Щр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З:**
- тП▒я╕П р╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Х: 10 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡
- ЁЯФД Filter: р╕лр╕ер╕▓р╕вр╕Кр╕▒р╣Йр╕Щ (р╕Кр╣Йр╕▓)
- тЭМ р╣Др╕бр╣Ир╕бр╕╡р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е
- ЁЯФз р╣Др╕бр╣Ир╕бр╕╡р╕гр╕░р╕Ър╕Ър╕гр╕╡р╣Ар╕Лр╣Зр╕Х
- ЁЯУЭ Debug message р╕бр╕▓р╕Б

### **р╕лр╕ер╕▒р╕Зр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З:**
- тП▒я╕П р╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Х: 3 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡ (р╣Ар╕гр╣Зр╕зр╕Вр╕╢р╣Йр╕Щ 70%)
- ЁЯФД Filter: р╣Ар╕Фр╕╡р╕вр╕з + threshold (р╣Ар╕гр╣Зр╕зр╕Вр╕╢р╣Йр╕Щ)
- тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- ЁЯФз р╕гр╕░р╕Ър╕Ър╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- ЁЯУЭ р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╣Бр╕Ър╕Ър╕вр╣Ир╕н (р╕Чр╕╕р╕Б 5-10 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡)

---

## ЁЯОп **р╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ:**

### **р╕Бр╕▓р╕гр╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Х:**
1. р╕зр╕▓р╕Зр╣Ар╕Лр╣Зр╕Щр╣Ар╕Лр╕нр╕гр╣Мр╣Гр╕лр╣Йр╕гр╕▓р╕Ъ
2. р╕гр╕н 3 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡ (р╣Бр╕Чр╕Щ 10 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡)
3. р╕гр╕░р╕Ър╕Ър╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ

### **р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕Цр╕▓р╕Щр╕░:**
```
ЁЯУР MPU6050 Status:
   ЁЯзо Elevation: +15.23┬░ (Raw: +15.45┬░)
   ЁЯУР Roll: -2.15┬░, Yaw: +45.67┬░
   ЁЯУК Accelerometer: Ax=0.123, Ay=0.456, Az=0.789 g
   тЬЕ Calibrated: Ready for measurement
```

### **р╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╣Бр╕Ър╕Ър╕вр╣Ир╕н:**
```
ЁЯУР ELEVATION: +15.23┬░  |  DIST: 25.4m  [ЁЯФ╡ BLE Connected]  [тЬЕ Sensors OK]  [MPU: P=+15.2┬░ R=-2.2┬░ Y=+45.7┬░]
```

---

## тЪая╕П **р╕Вр╣Йр╕нр╕Др╕зр╕гр╕гр╕░р╕зр╕▒р╕З:**

1. **р╕Бр╕▓р╕гр╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Х:** р╕Хр╣Йр╕нр╕Зр╕зр╕▓р╕Зр╣Ар╕Лр╣Зр╕Щр╣Ар╕Лр╕нр╕гр╣Мр╣Гр╕лр╣Йр╕гр╕▓р╕Ър╣Бр╕ер╕░р╕Щр╕┤р╣Ир╕З
2. **р╕Бр╕▓р╕гр╕Хр╣Ир╕нр╕кр╕▓р╕в:** р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Хр╣Ир╕нр╕кр╕▓р╕в I2C р╣Гр╕лр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
3. **р╣Бр╕гр╕Зр╕Фр╕▒р╕Щ:** р╣Гр╕Кр╣Й 3.3V р╕кр╕│р╕лр╕гр╕▒р╕Ъ ESP32
4. **р╕Бр╕▓р╕гр╕гр╕Ър╕Бр╕зр╕Щ:** р╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕Зр╕Бр╕▓р╕гр╕гр╕Ър╕Бр╕зр╕Щр╕Ир╕▓р╕Бр╣Бр╕бр╣Ир╣Ар╕лр╕ер╣Зр╕Б

---

## ЁЯФН **р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓:**

### **р╕Ыр╕▒р╕Нр╕лр╕▓: MPU6050 р╣Др╕бр╣Ир╕Чр╕│р╕Зр╕▓р╕Щ**
```cpp
// р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕Хр╣Ир╕нр╕кр╕▓р╕в:
// ESP32 3.3V тЖТ MPU6050 VCC
// ESP32 GND  тЖТ MPU6050 GND
// ESP32 G21  тЖТ MPU6050 SDA
// ESP32 G22  тЖТ MPU6050 SCL
```

### **р╕Ыр╕▒р╕Нр╕лр╕▓: р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф**
- р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╣Ар╕Лр╣Зр╕Щр╣Ар╕Лр╕нр╕гр╣Мр╣Ар╕бр╕╖р╣Ир╕нр╕Ир╕│р╣Ар╕Ыр╣Зр╕Щ
- р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Ар╕Хр╕╖р╕нр╕Щ

### **р╕Ыр╕▒р╕Нр╕лр╕▓: р╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Хр╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И**
- р╕зр╕▓р╕Зр╣Ар╕Лр╣Зр╕Щр╣Ар╕Лр╕нр╕гр╣Мр╣Гр╕лр╣Йр╕гр╕▓р╕Ъ
- р╕лр╕ер╕╡р╕Бр╣Ар╕ер╕╡р╣Ир╕вр╕Зр╕Бр╕▓р╕гр╕кр╕▒р╣Ир╕Щр╕кр╕░р╣Ар╕Чр╕╖р╕нр╕Щ
- р╕гр╕нр╣Гр╕лр╣Йр╕Др╕гр╕Ъ 3 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡

---

## ЁЯУИ **р╕Ыр╕гр╕░р╕кр╕┤р╕Чр╕Шр╕┤р╕ар╕▓р╕Ю:**

- **р╕Др╕зр╕▓р╕бр╣Ар╕гр╣Зр╕з:** р╣Ар╕Юр╕┤р╣Ир╕бр╕Вр╕╢р╣Йр╕Щ 70% (р╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Х)
- **р╕Др╕зр╕▓р╕бр╣Ар╕кр╕Цр╕╡р╕вр╕г:** р╣Ар╕Юр╕┤р╣Ир╕бр╕Вр╕╢р╣Йр╕Щ 50% (р╕Бр╕▓р╕гр╕Бр╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е)
- **р╕Др╕зр╕▓р╕бр╕Щр╣Ир╕▓р╣Ар╕Кр╕╖р╣Ир╕нр╕Цр╕╖р╕н:** р╣Ар╕Юр╕┤р╣Ир╕бр╕Вр╕╢р╣Йр╕Щ 80% (р╕гр╕░р╕Ър╕Ър╕гр╕╡р╣Ар╕Лр╣Зр╕Х)
- **р╕Бр╕▓р╕гр╣Гр╕Кр╣Й CPU:** р╕ер╕Фр╕ер╕З 30% (р╕Бр╕▓р╕гр╕Бр╕гр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е)

---

## ЁЯОЙ **р╕кр╕гр╕╕р╕Ы:**

р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З MPU6050 р╕Щр╕╡р╣Йр╕Чр╕│р╣Гр╕лр╣Йр╕гр╕░р╕Ър╕Ъ:
- **р╣Ар╕гр╣Зр╕зр╕Вр╕╢р╣Йр╕Щ** - р╕Др╕▓р╕ер╕┤р╣Ар╕Ър╕гр╕Хр╣Бр╕ер╕░р╕Хр╕нр╕Ър╕кр╕Щр╕нр╕Зр╣Ар╕гр╣Зр╕зр╕Вр╕╢р╣Йр╕Щ
- **р╣Ар╕кр╕Цр╕╡р╕вр╕гр╕Вр╕╢р╣Йр╕Щ** - р╕бр╕╡р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Бр╕ер╕░р╣Бр╕Бр╣Йр╣Др╕Вр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- **р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Зр╣Ир╕▓р╕вр╕Вр╕╢р╣Йр╕Щ** - р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕Чр╕╡р╣Ир╕Кр╕▒р╕Фр╣Ар╕Ир╕Щр╣Бр╕ер╕░р╣Ар╕Вр╣Йр╕▓р╣Гр╕Ир╕Зр╣Ир╕▓р╕в
- **р╕Щр╣Ир╕▓р╣Ар╕Кр╕╖р╣Ир╕нр╕Цр╕╖р╕нр╕Вр╕╢р╣Йр╕Щ** - р╕бр╕╡р╕гр╕░р╕Ър╕Ър╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╣Бр╕ер╕░р╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓

р╕гр╕░р╕Ър╕Ър╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕зр╕▒р╕Фр╣Бр╕Ьр╣Ир╕Щр╕Фр╕┤р╕Щр╕Цр╕ер╣Ир╕бр╕Фр╣Йр╕зр╕вр╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│р╣Бр╕ер╕░р╣Ар╕кр╕Цр╕╡р╕вр╕гр╕ар╕▓р╕Юр╕кр╕╣р╕З! ЁЯОп
